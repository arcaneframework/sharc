// -*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-
//-----------------------------------------------------------------------------
// Copyright 2000-2025 CEA (www.cea.fr) IFPEN (www.ifpenergiesnouvelles.com)
// See the top-level COPYRIGHT file for details.
// SPDX-License-Identifier: Apache-2.0
//-----------------------------------------------------------------------------
// -*- C++ -*-
#ifndef ARCGEOSIM_PHYSICS_LAW_EVALFUNCTIONTRAITS_H
#define ARCGEOSIM_PHYSICS_LAW_EVALFUNCTIONTRAITS_H
/* Author : desrozis at Wed Nov  7 15:33:28 2012
 * Generated by createNew
 */

/*
 * \ingroup Law
 * \brief Outil interne pour l'invocation de la signature d'une fonction
 *
 */

#include "ArcGeoSim/Utils/ArcGeoSim.h"

#include <boost/fusion/include/size.hpp>
#include <boost/fusion/include/vector.hpp>
#include <boost/fusion/include/at_c.hpp>
#include <boost/preprocessor/iteration/local.hpp>
#include <boost/preprocessor/repetition/enum.hpp>

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

BEGIN_LAW_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

namespace details {

template<typename T,typename V, Integer>
struct EvalFunc;

#define EVAL_MAX_SIZE 20

#define SIG(z,n,x) typename boost::fusion::result_of::at_c< x, n>::type

#define EVALFUNCSIG(z,n,V)                       \
  template<typename T, typename V>               \
  struct EvalFunc<T,V,n>                         \
  {                                              \
     typedef void (T::*func_type)( BOOST_PP_ENUM(n,SIG,V) ) const; \
  };
BOOST_PP_REPEAT(EVAL_MAX_SIZE, EVALFUNCSIG,V)

#undef EVALFUNCSIG
#undef SIG

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

  template <class T, typename EvalFunc<T const,typename T::Signature::FuncSigTypes,T::Signature::nb_eval_arguments>::func_type const>
  struct member_eval_bind
  {
    typedef T type;
  };

  template <class T1, class T2>
  struct has_eval
  {
    static const bool value = false;
  };

  template <class T>
  struct has_eval<T, typename member_eval_bind<T, &T::eval>::type>
  {
    static const bool value = true;
  };

  template <class T>
  struct is_valid_eval
  {
    static const bool value = has_eval<T, T>::value;
  };
  
  template <class T, typename EvalFunc<T const,typename T::Signature::DerivFuncSigTypes,T::Signature::nb_diff_eval_arguments>::func_type const>
  struct member_diff_eval_bind
  {
    typedef T type;
  };

  template <class T1, class T2>
  struct has_diff_eval
  {
    static const bool value = false;
  };

  template <class T>
  struct has_diff_eval<T, typename member_diff_eval_bind<T, &T::eval>::type>
  {
    static const bool value = true;
  };

  template <class T>
  struct is_valid_diff_eval
  {
    static const bool value = has_diff_eval<T, T>::value;
  };

}

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

template<typename T>
struct EvalFunctionTraits
{
  static const bool is_valid          = details::is_valid_eval     <T>::value;
  static const bool is_differentiable = details::is_valid_diff_eval<T>::value;
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

END_LAW_NAMESPACE;

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#endif /* ARCGEOSIM_PHYSICS_LAW_EVALFUNCTIONTRAITS_H */
