// -*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-
//-----------------------------------------------------------------------------
// Copyright 2000-2025 CEA (www.cea.fr) IFPEN (www.ifpenergiesnouvelles.com)
// See the top-level COPYRIGHT file for details.
// SPDX-License-Identifier: Apache-2.0
//-----------------------------------------------------------------------------
// -*- C++ -*-
#ifndef ARCGEOSIM_ARCGEOSIM_PHYSICS_LAW_SIGNATUREARGUMENTS_H
#define ARCGEOSIM_ARCGEOSIM_PHYSICS_LAW_SIGNATUREARGUMENTS_H
/* Author : desrozis at Mon Nov  5 16:19:26 2012
 * Generated by createNew
 */

/*
 * \ingroup Law
 * \brief Informations descriptives statiques des signatures
 *
 * Les outils de programmation g�n�rique de boost (mpl,fusion) sont utilis�s
 *
 * Une signature a un nombre d'arguments ce qui induit des conteneurs associ�s.
 * Les pointeurs sont utilis�es plut�t que les r�f�rences par commodit�
 *
 * Exemple :
 *
 * Entr�e : Law::In <Law::ScalarReal,
 *                   Law::ScalarReal,
 *                   Law::VectorialReal>
 * 
 * Sortie : Law::Out<Law::ScalarReal,
 *                   Law::ScalarReal,
 *                   Law::VectorialReal>
 *
 * 3 arguments en entr�e et sortie
 * (TO DO : param�tres)
 *
 * Propri�t�s (entr�e et sortie) : ScalarRealProperty, ScalarRealProperty, VectorialRealProperty
 *
 * Type de donn�es (entr�e et sortie) :
 * - pour states : entr�e : const Real*, const Real*, const RealArray*
 *                 sortie :       Real*,       Real*,       RealArray*
 * 
 * - pour variables : entr�e : const ItemVariableScalarRefT<Real>*, const ItemVariableScalarRefT<Real>*, const ItemVariableArrayRefT<Real>*
 *                    sortie :       ItemVariableScalarRefT<Real>*,       ItemVariableScalarRefT<Real>*,       ItemVariableArrayRefT<Real>*
 *
 * etc.
 *
 * REMARQUE : Les choses seraient beaucoup plus simples en C++11 !
 *
 */

#include "ArcGeoSim/Physics/Law1/Argument.h"
#include "ArcGeoSim/Physics/Law1/ContainerTraits.h"

#include "ArcGeoSim/Physics/Law1/Mpl.h"

#include <boost/mpl/transform.hpp>
#include <boost/mpl/remove_if.hpp>
#include <boost/mpl/size.hpp>
#include <boost/type_traits/add_pointer.hpp>
#include <boost/type_traits/add_const.hpp>

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

BEGIN_LAW_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

namespace details {
  
  template<typename T> struct ArgumentToProperty
  { typedef typename T::PropertyType type; };

  template<typename T> struct ArgumentToFuncSigInType
  { typedef typename T::in_type type; };

  template<typename T> struct ArgumentToFuncSigOutType
  { typedef typename T::out_type type; };

  template<typename T> struct ArgumentToFuncSigDerivType
  { typedef typename T::deriv_type type; };

  
  template<typename T> struct PropertyToValue
  { typedef typename T::ValueType type; };
  
  template<typename T> struct PropertyToDeriv
  { typedef typename T::DerivType type; };
  
  template<typename... T>
  struct SignatureTraitsT
  {
    // Vecteur de tous les arguments
    typedef boost::mpl::vector<T...> AllArgumentTypes;
    
    // Vecteur de tous les arguments diff�rents de boost::mpl::void_
    // NB : dans version de boost r�centes, boost::mpl::back_inserter est optionel
    typedef typename boost::mpl::remove_if<AllArgumentTypes,
                                           boost::mpl::is_void_<boost::mpl::_>,
                                           boost::mpl::back_inserter< boost::mpl::vector0<> >
    >::type ArgumentTypes;
    
    // Taille de la signature
    static const Integer nb_arguments = boost::mpl::size<ArgumentTypes>::value;
    
    // Transformation des types d'argument en type de propri�t�s
    // ie    ScalarReal =>    ScalarRealProperty
    //    VectorialReal => VectorialRealProperty 
    // ...
    typedef typename boost::mpl::transform<ArgumentTypes,
                                           details::ArgumentToProperty<boost::mpl::_>
    >::type PropertyTypes;
  };

}

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#define TRANSFORM(traits,op,name)                                       \
  typedef typename boost::mpl::transform<PropertyTypes,                 \
                   boost::add_pointer< details::PropertyTo##op< traits<boost::mpl::_> > > \
  >::type name;
template<typename... T>
struct In : public details::SignatureTraitsT<T...>
{
  typedef typename details::SignatureTraitsT<T...> Base;
  
  typedef typename Base::PropertyTypes PropertyTypes;
  

  typedef typename
  boost::mpl::transform<typename Base::ArgumentTypes,
                        details::ArgumentToFuncSigInType<boost::mpl::_>
                       >::type                                              FuncSigTypes;

  // Transformation des propri�t�s en type de donn�es (State)
  // ie    ScalarRealProperty => Real const*
  //    VectorialRealProperty => RealArray const*
  // ...
  TRANSFORM(StateContainer,Value,ValueTypes);

  // Transformation des propri�t�s en type de donn�es (State) pour d�riv�es
  // ie    ScalarRealProperty => RealArray*
  //    VectorialRealProperty => RealArray2*
  // ...
  TRANSFORM(StateContainer,Deriv,DerivativeValueTypes);
  
  // Transformation des propri�t�s en type de donn�es (Variable)
  // ie    ScalarRealProperty => const ItemVariableScalarRefT<Real>*
  //    VectorialRealProperty => const ItemVariableArrayRefT<Real>*
  // ...
  TRANSFORM(GenericVariableContainer,Value,VariableTypes);

  // Transformation des propri�t�s en type de donn�es (Variable) pour d�riv�es
  // ie    ScalarRealProperty => ItemVariableArrayRefT<Real>*
  //    VectorialRealProperty => ItemVariableArray2RefT<Real>*
  // ...
  TRANSFORM(GenericVariableContainer,Deriv,DerivativeVariableTypes);
  
  // Transformation des propri�t�s en type de donn�es (Variable partielle)
  // ie    ScalarRealProperty => const ItemPartialVariableScalarRefT<Real>*
  //    VectorialRealProperty => const ItemPartialVariableArrayRefT<Real>*
  // ...
  TRANSFORM(GenericPartialVariableContainer,Value,PartialVariableTypes);

  // Transformation des propri�t�s en type de donn�es (Variable partielle) pour d�riv�es
  // ie    ScalarRealProperty => ItemPartialVariableArrayRefT<Real>*
  //    VectorialRealProperty => ItemPartialVariableArray2RefT<Real>*
  // ...
  TRANSFORM(GenericPartialVariableContainer,Deriv,DerivativePartialVariableTypes);
  
  // Transformation des propri�t�s en type de donn�es (Tableau)
  // ie    ScalarRealProperty => const VariableRefArrayT<Real>*
  //    VectorialRealProperty => const VariableRefArray2T<Real>*
  // ...
  TRANSFORM(ArrayContainer,Value,ArrayTypes);

  // Transformation des propri�t�s en type de donn�es (Tableau) pour d�riv�es
  // ie    ScalarRealProperty => VariableRefArray2T<Real>*
  //    VectorialRealProperty => VariableRefArray3T<Real>*
  // ...
  TRANSFORM(ArrayContainer,Deriv,DerivativeArrayTypes);

  // Transformation des propri�t�s en type de donn�es (Scalaire)
  // ie    ScalarRealProperty => const VariableRefScalarT<Real>*
  //    VectorialRealProperty => const VariableRefArrayT<Real>*
  // ...
  TRANSFORM(ScalarContainer,Value,ScalarTypes);

  // Transformation des propri�t�s en type de donn�es (State) pour d�riv�es
  // ie    ScalarRealProperty => VariableRefArrayT<Real>*
  //    VectorialRealProperty => VariableRefArray2T<Real>*
  // ...
  TRANSFORM(ScalarContainer,Deriv,DerivativeScalarTypes);

};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/



template<typename... T>
struct Out : public details::SignatureTraitsT<T...>
{
  typedef typename details::SignatureTraitsT<T...> Base;
  
  typedef typename Base::PropertyTypes PropertyTypes;

  typedef typename
  boost::mpl::transform<typename Base::ArgumentTypes,
                        details::ArgumentToFuncSigOutType<boost::mpl::_>
                       >::type                                              FuncSigTypes;

  typedef typename
  boost::mpl::transform<typename Base::ArgumentTypes,
                        details::ArgumentToFuncSigDerivType<boost::mpl::_>
                       >::type                                              FuncSigDerivTypes;

  typedef typename mpl::merge<FuncSigTypes, FuncSigDerivTypes>::type        DerivFuncSigTypes;

  // Transformation des propri�t�s en type de donn�es (State)
  // ie    ScalarRealProperty => Real*
  //    VectorialRealProperty => RealArray*
  // ...
  TRANSFORM(StateContainer,Value,ValueTypes); 
  
  // Transformation des propri�t�s en type de donn�es (State) pour d�riv�es
  // ie    ScalarRealProperty => RealArray*
  //    VectorialRealProperty => RealArray2*
  // ...
  TRANSFORM(StateContainer,Deriv,DerivativeValueTypes); 
  
  // Vecteur de tous les arguments altern�s avec les d�riv�es
  typedef typename mpl::merge<ValueTypes, DerivativeValueTypes>::type ValueAndDerivativeTypes;
  
  // Transformation des propri�t�s en type de donn�es (Variable)
  // ie    ScalarRealProperty => ItemVariableScalarRefT<Real>*
  //    VectorialRealProperty => ItemVariableArrayRefT<Real>*
  // ...
  TRANSFORM(GenericVariableContainer,Value,VariableTypes);  

  // Transformation des propri�t�s en type de donn�es (Variable) pour d�riv�es
  // ie    ScalarRealProperty => ItemVariableArrayRefT<Real>*
  //    VectorialRealProperty => ItemVariableArray2RefT<Real>*
  // ...
  TRANSFORM(GenericVariableContainer,Deriv,DerivativeVariableTypes);  

  // Vecteur de toutes les variables altern�s avec les d�riv�es
  typedef typename mpl::merge<VariableTypes,DerivativeVariableTypes>::type VariableAndDerivativeTypes;
  
  // Transformation des propri�t�s en type de donn�es (Variable partielle)
  // ie    ScalarRealProperty => ItemPartialVariableScalarRefT<Real>*
  //    VectorialRealProperty => ItemPartialVariableArrayRefT<Real>*
  // ...
  TRANSFORM(GenericPartialVariableContainer,Value,PartialVariableTypes);

  // Transformation des propri�t�s en type de donn�es (Variable partielle) pour d�riv�es
  // ie    ScalarRealProperty => ItemPartialVariableArrayRefT<Real>*
  //    VectorialRealProperty => ItemPartialVariableArray2RefT<Real>*
  // ...
  TRANSFORM(GenericPartialVariableContainer,Deriv,DerivativePartialVariableTypes);  

  // Vecteur de toutes les variables altern�s avec les d�riv�es
  typedef typename mpl::merge<PartialVariableTypes,DerivativePartialVariableTypes>::type PartialVariableAndDerivativeTypes;
  
  // Transformation des propri�t�s en type de donn�es (Tableau)
  // ie    ScalarRealProperty => VariableRefArrayT<Real>*
  //    VectorialRealProperty => VariableRefArray2T<Real>*
  // ...
  TRANSFORM(ArrayContainer,Value,ArrayTypes);

  // Transformation des propri�t�s en type de donn�es (Tableau) pour d�riv�es
  // ie    ScalarRealProperty => VariableRefArray2T<Real>*
  //    VectorialRealProperty => VariableRefArray3T<Real>*
  // ...
  TRANSFORM(ArrayContainer,Deriv,DerivativeArrayTypes);
  
  // Vecteur de toutes les variables altern�s avec les d�riv�es
  typedef typename mpl::merge<ArrayTypes,DerivativeArrayTypes>::type ArrayAndDerivativeTypes;

  // Transformation des propri�t�s en type de donn�es (Scalaire)
  // ie    ScalarRealProperty => VariableRefScalarT<Real>*
  //    VectorialRealProperty => VariableRefArrayT<Real>*
  // ...
  TRANSFORM(ScalarContainer,Value,ScalarTypes);

  // Transformation des propri�t�s en type de donn�es (State) pour d�riv�es
  // ie    ScalarRealProperty => VariableRefArrayT<Real>*
  //    VectorialRealProperty => VariableRefArray2T<Real>*
  // ...
  TRANSFORM(ScalarContainer,Deriv,DerivativeScalarTypes);

  // Vecteur de toutes les variables altern�s avec les d�riv�es
  typedef typename mpl::merge<ScalarTypes,DerivativeScalarTypes>::type ScalarAndDerivativeTypes;
};

#undef TRANSFORM

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

template<typename... T>
struct Parameters : public In<T...>
{

  typedef typename details::SignatureTraitsT<T...> Base;

  typedef typename Base::PropertyTypes PropertyTypes;
  typedef typename
  boost::mpl::transform<typename Base::ArgumentTypes,
                        details::ArgumentToFuncSigInType<boost::mpl::_>
                       >::type                                              FuncSigTypes;
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

END_LAW_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#endif /* ARCGEOSIM_ARCGEOSIM_PHYSICS_LAW_SIGNATUREARGUMENTS_H */
