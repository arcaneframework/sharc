// -*- C++ -*-
#ifndef LAW_CONTRIBUTION_PARTIALVARIABLE_H
#define LAW_CONTRIBUTION_PARTIALVARIABLE_H
/* Author : desrozis at Tue Nov 13 08:40:09 2012
 * Generated by createNew
 */

#include "ArcGeoSim/Physics/Law2/Variable.h"
#include "ArcGeoSim/Physics/Law2/VariableRef.h"

#include "ArcGeoSim/Numerics/Contribution/Variable/PartialVariable.h"

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

BEGIN_LAW_NAMESPACE
BEGIN_AUDI_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

template<typename K>
class PartialVariable
    : public Law::VariableT< Law::PartialVariableRefT<Law::ScalarRealProperty,K> >
    , private ArcNum::audi::PartialVariable<K>
{
public:

  typedef typename Law::PartialVariableRefT<Law::ScalarRealProperty,K> Ref;
  typedef typename Law::VariableT< Ref >                               Base;
  typedef typename ArcNum::audi::PartialVariable<K>                    AuDiBase;

  PartialVariable() {}

  PartialVariable(const PartialVariable& rhs)
  : Base(rhs)
  , AuDiBase(rhs) {}

  PartialVariable(const Law::BuildInfo<Law::ScalarRealProperty>& bi)
  : Base(bi.property(), bi.offsets(), bi.variableMng().template partialVariables<K>())
  , AuDiBase(bi.offsets().constView())
  {
    auto const& property = bi.property() ;
    auto const& accessor = bi.variableMng().template variables<K>() ;
    AuDiBase::setValues(accessor.values(property)) ;
    if(accessor.hasDerivatives(property))
      AuDiBase::setDerivValues(&(accessor.derivatives(property))) ;
  }

  virtual ~PartialVariable() {}

public:

  
  inline const ArcNum::RootContribution& operator[](const K& item) const
  {
    return AuDiBase::operator[](item) ;
  }

  inline const ArcNum::RootContribution& operator[](const Arcane::ItemEnumeratorT<K>& iter) const
  {
    return AuDiBase::operator[](iter) ;
  }

  inline const ArcNum::RootContribution& operator[](const ArcNum::Stencil::ItemT<K>& item) const
  {
    return AuDiBase::operator[](item) ;
  }
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

END_LAW_NAMESPACE
END_AUDI_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#endif /* LAW_CONTRIBUTION_PARTIALVARIABLE_H */
