// -*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-
//-----------------------------------------------------------------------------
// Copyright 2000-2025 CEA (www.cea.fr) IFPEN (www.ifpenergiesnouvelles.com)
// See the top-level COPYRIGHT file for details.
// SPDX-License-Identifier: Apache-2.0
//-----------------------------------------------------------------------------
#ifndef ARCGEOSIM_ARCGEOSIM_SURFACEUTILS_CONTACTVARIABLE_H
#define ARCGEOSIM_ARCGEOSIM_SURFACEUTILS_CONTACTVARIABLE_H
/* Author : havep at Thu Jun  4 11:56:07 2009
 * Generated by createNew
 */

/*---------------------------------------------------------------------------*/

#include <arcane/ArcaneTypes.h>

#include "ArcGeoSim/Mesh/SurfaceUtils/Contact.h"
#include "ArcGeoSim/Utils/ArcGeoSim.h"
#include "ArcGeoSim/Mesh/SurfaceUtils/ContactGroup.h"
#include "ArcGeoSim/Mesh/SurfaceUtils/IContactVariable.h"
#include "ArcGeoSim/Mesh/SurfaceUtils/IContactFamily.h"

/*---------------------------------------------------------------------------*/

class ContactVariable : public IContactVariable 
{
public:
  //! Constructeur de la classe
  ContactVariable(IContactFamily * family);
  
  //! Destructeur de la classe
  virtual ~ContactVariable();

  //! D�tache de la famille associ�
  /*! Utilis� dans le cas des destructions de la famille avant les variables */
  void detachFromFamily();

private:
  //! No Copy Constructor
  ContactVariable(const ContactVariable & var);

protected:
  IContactFamily * m_family;
};

/*---------------------------------------------------------------------------*/

template<typename ContactTypeT, typename DataTypeT>
class ContactVariableT : public ContactVariable
{
public:
  typedef ContactTypeT ContactType;
  typedef DataTypeT DataType;

public:
  //! Constructeur de la classe
  ContactVariableT(IContactFamily * family)
    : ContactVariable(family)
  {
    m_data.resize(m_family->nbContact());
  }
  
  //! Destructeur de la classe
  virtual ~ContactVariableT()
  {
    ;
  }

private:
  //! No Copy Constructor
  /*! If you have an error on this line, you try to copy a ContactVariableT, uses a reference instead */
  ContactVariableT(const ContactVariableT & var);

public:
  //! Op�rateur d'acc�s
  inline DataType & operator[](const ContactType & contact) { return m_data[contact.localId()]; }

  //! Op�rateur d'acc�s (mode constant)
  inline DataType operator[](const ContactType & contact) const { return m_data[contact.localId()]; }

  //! Op�rateur d'acc�s
  inline DataType & operator[](const ContactEnumerator & contact) { return m_data[contact.localId()]; }

  //! Op�rateur d'acc�s (mode constant)
  inline DataType operator[](const ContactEnumerator & contact) const { return m_data[contact.localId()]; }

  //! Famille de contacts
  IContactFamily * contactFamily() const { return m_family; }

protected:
  SharedArray<DataType> m_data;
};

/*---------------------------------------------------------------------------*/

template<typename ContactTypeT, typename DataTypeT>
class ContactPartialVariableT : public ContactVariable
{
public:
  typedef ContactTypeT ContactType;
  typedef DataTypeT DataType;

public:
  //! Constructeur de la classe
  ContactPartialVariableT(const ContactGroup & group)
    : ContactVariable(group.family())
    , m_group(group)
  {
    m_data.resize(m_group.size());
  }
  
  //! Destructeur de la classe
  virtual ~ContactPartialVariableT()
  {
    ;
  }

private:
  //! No Copy Constructor
  ContactPartialVariableT(const ContactPartialVariableT & var);

public:
  //! Op�rateur d'acc�s
  inline DataType & operator[](const ContactEnumerator & contact) { return m_data[contact.index()]; }

  //! Op�rateur d'acc�s (mode constant)
  inline const DataType & operator[](const ContactEnumerator & contact) const { return m_data[contact.index()]; }

  //! Famille de contacts
  ContactGroup contactGroup() const { return m_group; }

protected:
  ContactGroup m_group;
  SharedArray<DataType> m_data;
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#endif /* ARCGEOSIM_ARCGEOSIM_SURFACEUTILS_CONTACTVARIABLE_H */
