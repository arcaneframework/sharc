// -*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-
//-----------------------------------------------------------------------------
// Copyright 2000-2025 CEA (www.cea.fr) IFPEN (www.ifpenergiesnouvelles.com)
// See the top-level COPYRIGHT file for details.
// SPDX-License-Identifier: Apache-2.0
//-----------------------------------------------------------------------------
// -*- C++ -*-
#ifndef ARCGEOSIM_SURFACEUTILS_FACEVECTORANALYSIS_H
#define ARCGEOSIM_SURFACEUTILS_FACEVECTORANALYSIS_H
/* Author : havep at Wed Mar 30 14:46:01 2011
 * Generated by createNew
 */

#include <arcane/Item.h>
#include <arcane/utils/Array.h>
#include <arcane/utils/Real3.h>
#include "arcane/VariableTypes.h"
#include <arcane/IMeshSubMeshTransition.h>
#include <arcane/IParallelMng.h>
#include <arcane/utils/ITraceMng.h>
#include <arcane/IMesh.h>

using namespace Arcane;

struct FaceVectorAnalysis
{
  //! Calcule les param�tres locaux d'une normale moyenne
  /*! \warning ne fonctionne que pour des maillages 3D */
  static RealSharedArray computeLocalMeanNormal(const FaceVectorView group,
                                          IMesh * mesh);

  //! Synth�tise les param�tres locaux pour obtenir une normale moyenne globale
  /*! Uses local normal sum (flag=false) or minization algorithm (flag=true)
   *  \warning ne fonctionne que pour des maillages 3D */
  static Real3 computeGlobalMeanNormal(RealConstArrayView local_normal_parameters, 
                                       IParallelMng * parallelMng, 
                                       ITraceMng * traceMng, 
                                       bool use_minimization_algorithm);

  //! Calcul la d�composition en composante connexe (2D ou 3D)
  /*! Le tableau \a faceColors contient pour chaque face sa couleur dans [0:maxColor[ */
  static void computeConnexComponents(const FaceVectorView & group,
                                      IMesh * mesh,
                                      IntegerArray & faceColors,
                                      Integer & maxColor);

private:
  //! Calcul la normale d'un triangle
  static Real3 computeNormal(const VariableNodeReal3 & nodes_coordinates,
                             const Node node1, const Node node2, const Node node3) {
    const Real3 node1_coord = nodes_coordinates[node1];
    const Real3 node2_coord = nodes_coordinates[node2];
    const Real3 node3_coord = nodes_coordinates[node3];
    return math::vecMul(node2_coord-node1_coord,node3_coord-node1_coord);
  }

  class FaceVectorConnectivity;
};

#endif /* ARCGEOSIM_SURFACEUTILS_FACEVECTORANALYSIS_H */
