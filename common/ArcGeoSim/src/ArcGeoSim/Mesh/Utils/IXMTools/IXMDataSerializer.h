// -*- C++ -*-
#ifndef ARCGEOSIM_ARCGEOSIM_MESH_UTILS_IXMTOOLS_IXMDATASERIALIZER_H
#define ARCGEOSIM_ARCGEOSIM_MESH_UTILS_IXMTOOLS_IXMDATASERIALIZER_H
/* Author : dechaiss at Tue Oct 16 10:49:53 2012
 * Generated by createNew
 */

#include <list>

#include <arcane/SerializeBuffer.h>

#include "ArcGeoSim/Utils/ArcGeoSim.h"
#include "ArcGeoSim/Mesh/Utils/IXMTools/IXMTools.h"
#include "ArcGeoSim/Utils/ParallelUtils.h"

BEGIN_ARCGEOSIM_NAMESPACE

USING_IXM_NAMESPACE

class IXMDataSerializer
{
  /*!
   * Classe permettant de serialiser et deserialiser des structures de donnees IXM en vue d'une diffusion en parallele (broadcast).
   * Classe utilisee dans le lecteur de maillage IXM.
   * Chaque appel a une methode serialize() doit etre suivie par un appel a la methode deserialize correspondante.
   * Classe testee dans IXMUnitaryTestsService
   * Classe basee sur Arcane::SerializeBuffer
   */

  enum SerializedType{
    ST_IXMGroupIncrementDataList,
    ST_IXMGroupIncrementData,
    ST_IXMGroupDataList,
    ST_IXMGroupData,
    ST_IXMPropertyData,
    ST_IXMPropertyDataList,
    ST_IXMPropertyIncrementData,
    ST_IXMPropertyIncrementDataList,
    ST_IXMFaceData,
    ST_UnknownType
  };

public:
  
  /** Constructeur de la classe */
  IXMDataSerializer(ParallelUtils& parallel_utils)
    : m_parallel_utils(parallel_utils)
    , m_buffer(NULL)
    , m_type(ST_UnknownType){}
  
  /** Destructeur de la classe */
  virtual ~IXMDataSerializer() {}
  
public:

  // Groupes ========================

  //! Serialisation/deserialisation d'une liste de donnees d'increments de groupe
  void serialize(const IXMGroupIncrementDataList& group_increment_data_list);
  void deserialize(IXMGroupIncrementDataList& group_increment_data_list);

  //! Serialisation/deserialisation d'une donnee d'increment de groupe
  void serialize(const IXMGroupIncrementData& group_increment_data);
  void deserialize(IXMGroupIncrementData& group_increment_data);

  //! Serialisation/deserialisation d'une liste de donnees de groupe
  void serialize(const IXMGroupDataList& group_data_list);
  void deserialize(IXMGroupDataList& group_data_list);

  //! Serialisation/deserialisation d'une donnee de groupe
  void serialize(const IXMGroupData& group_data);
  void deserialize(IXMGroupData& group_data);

  // Proprietes ================================

  //! Serialisation/deserialisation d'une liste de donnees d'increments de propriete
  void serialize(const IXMPropertyIncrementDataList& property_increment_data_list);
  void deserialize(IXMPropertyIncrementDataList& property_increment_data_list);

  //! Serialisation/deserialisation d'une liste de donnees de proprietes
  void serialize(const IXMPropertyDataList& property_data_list);
  void deserialize(IXMPropertyDataList& property_data_list);

  //! Serialisation/deserialisation d'une donnees de proprietes
  void serialize(const IXMPropertyData& property_data);
  void deserialize(IXMPropertyData& property_data);

  //! Serialisation/deserialisation d'une donnees d'increment de proprietes
  void serialize(const IXMPropertyIncrementData& property_increment_data);
  void deserialize(IXMPropertyIncrementData& property_increment_data);

  // Faces =======================================
  void serialize(const IXMFaceData& face_data);
  void deserialize(IXMFaceData& face_data);

  //! Diffusion du buffer
  void broadcast();

private:
  ParallelUtils m_parallel_utils;
  Arcane::SerializeBuffer* m_buffer;
  SerializedType m_type;

private:

  template <typename IXMDataType> void serializeT(const IXMDataType& ixm_data_type);
  template <typename IXMDataType> void deserializeT(IXMDataType& ixm_data_type);
  template <typename IXMDataTypeList> void serializeListT(const IXMDataTypeList& ixm_data_type_list);
  template <typename IXMDataTypeList> void deserializeListT(IXMDataTypeList& ixm_data_type_list);
  void _reserveBufferSize(const IXMGroupIncrementData& group_increment_data);
  void _reserveBufferSize(const IXMGroupData& group_data);
  void _reserveBufferSize(const IXMPropertyData& property_data);
  void _reserveBufferSize(const IXMPropertyIncrementData& property_increment_data);
  void _reserveBufferSize(const IXMFaceData& face_data);
  void _reserveBaseBufferSize(const IXMPropertyDataBase& property_data_base);
  void _serialize(const IXMGroupIncrementData& group_increment_data);
  void _serialize(const IXMGroupData& group_data);
  void _serialize(const IXMPropertyData& property_data);
  void _serialize(const IXMPropertyIncrementData& property_data);
  void _serialize(const IXMFaceData& face_data);
  void _serializeBase(const IXMPropertyDataBase& property_data_base);
  void _deserialize(IXMGroupIncrementData& group_increment_data);
  void _deserialize(IXMGroupData& group_data);
  void _deserialize(IXMPropertyData& property_data);
  void _deserialize(IXMPropertyIncrementData& property_increment_data);
  void _deserialize(IXMFaceData& face_data);
  void _deserializeBase(IXMPropertyDataBase& property_data_base);

  Arcane::String _serializedTypeName(const SerializedType serialized_type);
  SerializedType _serializedTypeFromName(const Arcane::String& serialized_type_name);

public:

  template <class IXMDataType>
  class SerializedTypeTraits
  {
  public:
    static SerializedType type() {return  ST_UnknownType;}
    static Arcane::String name() {return "ST_UnknownType";}
  };

};

  template<>
  class IXMDataSerializer::SerializedTypeTraits<ArcGeoSim::IXMTools::IXMGroupIncrementDataList>
  {
  public:
    static SerializedType type() {return ST_IXMGroupIncrementDataList;}
    static Arcane::String name() {return "ST_IXMGroupIncrementDataList";}
    typedef ArcGeoSim::IXMTools::IXMGroupIncrementData IXMDataType;
  };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMGroupIncrementData>
  {
  public:
    static SerializedType type() {return ST_IXMGroupIncrementData;}
    static Arcane::String name() {return "ST_IXMGroupIncrementData";}
  };

  template<>
    class IXMDataSerializer::SerializedTypeTraits<IXMGroupDataList>
    {
    public:
      static SerializedType type() {return ST_IXMGroupDataList;}
      static Arcane::String name() {return "ST_IXMGroupDataList";}
      typedef ArcGeoSim::IXMTools::IXMGroupData IXMDataType;
    };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMGroupData>
  {
  public:
    static SerializedType type() {return ST_IXMGroupData;}
    static Arcane::String name() {return "ST_IXMGroupData";}
  };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMPropertyData>
  {
  public:
    static SerializedType type() {return ST_IXMPropertyData;}
    static Arcane::String name() {return "ST_IXMPropertyData";}
  };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMPropertyDataList>
  {
  public:
    static SerializedType type() {return ST_IXMPropertyDataList;}
    static Arcane::String name() {return "ST_IXMPropertyDataList";}
    typedef ArcGeoSim::IXMTools::IXMPropertyData IXMDataType;
  };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMPropertyIncrementData>
  {
  public:
    static SerializedType type() {return ST_IXMPropertyIncrementData;}
    static Arcane::String name() {return "ST_IXMPropertyIncrementData";}
  };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMPropertyIncrementDataList>
  {
  public:
    static SerializedType type() {return ST_IXMPropertyIncrementDataList;}
    static Arcane::String name() {return "ST_IXMPropertyIncrementDataList";}
    typedef ArcGeoSim::IXMTools::IXMPropertyIncrementData IXMDataType;
  };

  template<>
  class IXMDataSerializer::SerializedTypeTraits<IXMFaceData>
  {
  public:
    static SerializedType type() {return ST_IXMFaceData;}
    static Arcane::String name() {return "ST_IXMFaceData";}
  };



END_ARCGEOSIM_NAMESPACE

#endif /* ARCGEOSIM_ARCGEOSIM_MESH_UTILS_IXMTOOLS_IXMDATASERIALIZER_H */
