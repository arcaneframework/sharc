#!/usr/bin/perl
use strict;

my $varname = shift @ARGV or usage();
my $filename = shift @ARGV or usage();

my $use_compact = 1;

my $output = $filename;
$output =~ s/\./_/g;
$output .= ".h";

open IFILE, $filename  or usage("Cannot open $filename : $!");
open OFILE, ">$output" or usage("Cannot open $filename : $!");

my $INCLUDEGUARD = uc($output);
$INCLUDEGUARD =~ s/\./_/g;

my $current_date = localtime();

print OFILE <<EOF;
/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/
// #WARNING#: This file has been generated automatically. Do not edit.
// $current_date generated by :
//   $0 $varname $filename
/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#ifndef $INCLUDEGUARD
#define $INCLUDEGUARD

static const unsigned char $varname\[\] = 
EOF

while(<IFILE>)
{
    s/\r//g;
    if ($use_compact) 
    {
        s/\s+/ /g;
        s/^\s*//g;
        s/\s*$//g;
    }
    s/\n/\\n/g;
		s/\\/\\\\/g;
    s/"/\\"/g;
    print OFILE "\"$_ \"\n" if ($_);
}

print OFILE <<EOF;
;

#endif /* $INCLUDEGUARD */
EOF

close IFILE;
close OFILE;

print STDERR "Conversion done in $output\n";

sub usage 
{
    my $err = shift;
    print "Error: $err\n" if ($err);
    print <<EOF;
$0 var_name file_name
EOF
    exit(1);
}
