/* Author : havep at Mon Jul 11 10:27:22 2011
 * Generated by createNew
 */

#include "ArcGeoSim/Numerics/LinearAlgebra2/PETScImpl/PETScPrecomp.h"
#include "ArcGeoSim/Numerics/LinearSolver/PETScSolverImpl/IPETScPC.h"

using namespace Arcane;
using namespace ArcGeoSim::Numerics;
#include "PETScPrecConfigHypreEuclid_axl.h"

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

// BEGIN_LINEARALGEBRA2SERVICE_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

class PETScPrecConfigHypreEuclidService :
  public ArcanePETScPrecConfigHypreEuclidObject
{
public:
  /** Constructeur de la classe */
  PETScPrecConfigHypreEuclidService(const Arcane::ServiceBuildInfo & sbi) : 
    ArcanePETScPrecConfigHypreEuclidObject(sbi) 
    {
      ;
    }
  
  /** Destructeur de la classe */
  virtual ~PETScPrecConfigHypreEuclidService() {}

public:

  //! Initialisation
  void configure(PC & pc, const Alien::IIndexManager * indexManager);

  //! Indicateur de support de résolution parallèle
  bool hasParallelSupport() const { return true; }

  //! Check need of KSPSetUp before calling this PC configure
  virtual bool needPrematureKSPSetUp() const;

public:
  //! Acces to TraceMng
  ITraceMng * traceMng() const { return BasicService::traceMng();  }
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

void 
PETScPrecConfigHypreEuclidService::
configure(PC & pc, const Alien::IIndexManager * indexManager)
{
  checkError("Set preconditioner",           PCSetType(pc,PCHYPRE));
  checkError("Set Hypre preconditioner",     PCHYPRESetType(pc,"euclid"));
#if ((PETSC_VERSION_MAJOR <= 3 && PETSC_VERSION_MINOR < 7) || (PETSC_VERSION_MAJOR < 3))
  checkError("Set Hypre Euclid levels"      ,PetscOptionsSetValue("-pc_hypre_euclid_levels"          ,String::format("{0}",options()->levels()).localstr()));
  checkError("Set Hypre Euclid block jacobi",PetscOptionsSetValue("-pc_hypre_euclid_bj"              ,String::format("{0}",options()->useBlockJacobi()).localstr()));
  checkError("Set Hypre Euclid statistics"  ,PetscOptionsSetValue("-pc_hypre_euclid_print_statistics",String::format("{0}",options()->printStatistics()).localstr()));
#else
  checkError("Set Hypre Euclid levels"      ,PetscOptionsSetValue(NULL, "-pc_hypre_euclid_levels"          ,String::format("{0}",options()->levels()).localstr()));
  checkError("Set Hypre Euclid block jacobi",PetscOptionsSetValue(NULL, "-pc_hypre_euclid_bj"              ,String::format("{0}",options()->useBlockJacobi()).localstr()));
  checkError("Set Hypre Euclid statistics"  ,PetscOptionsSetValue(NULL, "-pc_hypre_euclid_print_statistics",String::format("{0}",options()->printStatistics()).localstr()));
#endif
  checkError("Set Hypre Euclid options"     ,PCSetFromOptions(pc));
  // checkError("Hypre Euclid Viewer",PCView(pc,PETSC_NULL));
}

/*---------------------------------------------------------------------------*/

bool
PETScPrecConfigHypreEuclidService::
needPrematureKSPSetUp() const
{
  return false;
}

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

ARCANE_REGISTER_SERVICE_PETSCPRECCONFIGHYPREEUCLID(HypreEuclid,PETScPrecConfigHypreEuclidService);

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

// END_LINEARALGEBRA2SERVICE_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/
