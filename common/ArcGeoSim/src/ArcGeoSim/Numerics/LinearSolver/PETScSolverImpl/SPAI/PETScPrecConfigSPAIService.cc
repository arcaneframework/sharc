/* Author : havep at Fri Jun 27 21:34:36 2008
 * Generated by createNew
 */

#include "ArcGeoSim/Numerics/LinearAlgebra2/PETScImpl/PETScPrecomp.h"
#include "ArcGeoSim/Numerics/LinearSolver/PETScSolverImpl/IPETScPC.h"

using namespace Arcane;
using namespace ArcGeoSim::Numerics;
#include "PETScPrecConfigSPAI_axl.h"

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

class PETScPrecConfigSPAIService 
  : public ArcanePETScPrecConfigSPAIObject
{
public:
  /** Constructeur de la classe */
  PETScPrecConfigSPAIService(const Arcane::ServiceBuildInfo & sbi) : 
    ArcanePETScPrecConfigSPAIObject(sbi) 
    {
      ;
    }
  
  /** Destructeur de la classe */
  virtual ~PETScPrecConfigSPAIService() {}

public:

  //! Initialisation
  void configure(PC & pc, const Alien::IIndexManager * indexManager);

  //! Indicateur de support de résolution parallèle
  bool hasParallelSupport() const { return true; }

  //! Check need of KSPSetUp before calling this PC configure
  bool needPrematureKSPSetUp() const;

public:
  //! Acces to TraceMng
  ITraceMng * traceMng() const { return BasicService::traceMng();  }
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

void 
PETScPrecConfigSPAIService::
configure(PC & pc, const Alien::IIndexManager * indexManager)
{
  checkError("Set preconditioner",PCSetType(pc,PCSPAI));

  if (options()->epsilon() > 0 and options()->epsilon() < 1) 
    checkError("Set SPAI epsilon",PCSPAISetEpsilon(pc,options()->epsilon()));
  else
    fatal() << "SPAI epsilon must be in [0:1]";

  if (options()->nonzeroMax() >= 0)
    checkError("Set SPAI epsilon",PCSPAISetMaxNew(pc,options()->nonzeroMax()));
  else
    fatal() << "SPAI nonzero-max must be positive";
}

/*---------------------------------------------------------------------------*/

bool
PETScPrecConfigSPAIService::
needPrematureKSPSetUp() const
{
  return false;
}

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

ARCANE_REGISTER_SERVICE_PETSCPRECCONFIGSPAI(SPAI,PETScPrecConfigSPAIService);

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/
