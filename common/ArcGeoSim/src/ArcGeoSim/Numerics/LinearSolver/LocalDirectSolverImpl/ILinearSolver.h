#ifndef ARCGEOSIM_NUMERICS_LINEARSOLVER_ILINEARSOLVER_H
#define ARCGEOSIM_NUMERICS_LINEARSOLVER_ILINEARSOLVER_H
/* Author : desrozis at Mon Mar 30 15:43:55 2009
 * Generated by createNew
 */

/**
 * Interface du service du module de resolution linéaire.
 * Voir \ref secLinearSolver "Description des services de solveurs linéaires" pour plus de détails
 */

#include "ArcGeoSim/Utils/ArcGeoSim.h"
#include <arcane/utils/FatalErrorException.h>
#include <arcane/utils/TraceInfo.h>

#include "ArcGeoSim/Numerics/LinearSolver/LocalDirectSolverImpl/IBaseLinearSolver.h"

class ILinearSystemBuilder;
class ILinearSystem;

struct BuildType {
  enum eBuild 
    {
      eNone        = 0,    // rien a construire
      eBuildMatrix = 1<<0, // la matrice doit etre reconstruite
      eBuildRhs    = 1<<1  // Le second membre doit etre reconstruit
    };
};

/*---------------------------------------------------------------------------*/

#ifdef ARCGEOSIM_DISABLE_OLD_LINEARSOLVER
#define VIRTUAL_IMPL(x) { return x; }
#define EMPTY_VIRTUAL_IMPL() {}
#else /* ARCGEOSIM_DISABLE_OLD_LINEARSOLVER */
#define VIRTUAL_IMPL(x) = 0
#define EMPTY_VIRTUAL_IMPL() = 0;
#endif /* ARCGEOSIM_DISABLE_OLD_LINEARSOLVER */

namespace LocalDirectSolverNamespace {

class ILinearSolver : public IBaseLinearSolver
{
 public:
  /** Destructeur de la classe */
  virtual ~ILinearSolver() { }

  //! Setting linear system builder
  virtual void setLinearSystemBuilder(ILinearSystemBuilder * builder) EMPTY_VIRTUAL_IMPL();

  //!option to imposed extra constraint to solution
  virtual void setNullSpaceConstantOption(bool flag) EMPTY_VIRTUAL_IMPL() ;

  //! Retourne le nom du solveur
  virtual String getName() const VIRTUAL_IMPL("");

  //! Getting linear system
  virtual ILinearSystem * getLinearSystem() VIRTUAL_IMPL(NULL) ;

  //! Building linear system Tempory patch to enable solving several systems
  virtual bool buildLinearSystem(ILinearSystem*  system,Integer nextBuildStage=BuildType::eBuildMatrix|BuildType::eBuildRhs) VIRTUAL_IMPL(false) ;

  //! Building linear system
  virtual bool buildLinearSystem(Integer nextBuildStage=BuildType::eBuildMatrix|BuildType::eBuildRhs) VIRTUAL_IMPL(false) ;

  //! @name Resolution step
  //@{
  
  //! Initializing (before solve)
  virtual void start() EMPTY_VIRTUAL_IMPL() ;
  
  //! Solving    
  virtual bool solve() VIRTUAL_IMPL(false) ;

  //! Getting solution
  virtual bool getSolution() VIRTUAL_IMPL(false) ;

  //@}
  
#define USE_MULTI_SOLVER_INSTANCE  
#ifdef USE_MULTI_SOLVER_INSTANCE
  class Solver
  {
  public :
    Solver(){}
    virtual ~Solver(){}

    virtual ILinearSystem * getLinearSystem() VIRTUAL_IMPL(NULL) ;

    virtual bool solve(ILinearSystem* system,Status& status) const VIRTUAL_IMPL(false) ;

    virtual bool getSolution(ILinearSystemBuilder* builder,ILinearSystem* system) const VIRTUAL_IMPL(false) ;

  };
  
  virtual Solver* create() const {
    return NULL ;
  }
#endif /* USE_MULTI_SOLVER_INSTANCE */
};

/*---------------------------------------------------------------------------*/

};

#undef VIRTUAL_IMPL
#undef EMPTY_VIRTUAL_IMPL

#endif /* ARCGEOSIM_NUMERICS_LINEARSOLVER_ILINEARSOLVER_H */
