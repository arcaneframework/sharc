// -*- tab-width: 2; indent-tabs-mode: nil; coding: utf-8-with-signature -*-
//-----------------------------------------------------------------------------
// Copyright 2000-2025 CEA (www.cea.fr) IFPEN (www.ifpenergiesnouvelles.com)
// See the top-level COPYRIGHT file for details.
// SPDX-License-Identifier: Apache-2.0
//-----------------------------------------------------------------------------
// -*- C++ -*-
#ifndef ARCGEOSIM_ARCGEOSIM_NUMERICS_LINEARALGEBRA2_BLOCKSIZES_H
#define ARCGEOSIM_ARCGEOSIM_NUMERICS_LINEARALGEBRA2_BLOCKSIZES_H
/* Author : desrozis at Thu Mar 14 12:29:22 2013
 * Generated by createNew
 */

#include <arcane/utils/UtilsTypes.h>

#ifdef USE_ALIEN_V1
#include <ALIEN/Utils/VMap.h>
#else
#include <alien/utils/VMap.h>
#endif

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

BEGIN_ALIEN_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

class IIndexManager;

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

class BlockSizes
{
public:


  //#ifdef USE_ALIEN_V1
  typedef VMap<Integer,Integer> ValuePerBlock;
  //#endif

  BlockSizes();
  
  ~BlockSizes() {}
  
  void prepare(const IIndexManager& index_mng, Arcane::IntegerConstArrayView block_sizes);

  //#ifdef USE_ALIEN_V1
  const ValuePerBlock& sizes() const { return m_sizes; }
  //#endif

public:
  
  Integer size(Integer index) const;
  Integer sizeFromLocalIndex(Integer index) const;

  Integer offset(Integer index) const;
  Integer offsetFromLocalIndex(Integer index) const;

  Integer localSize() const;

  Integer maxSize() const;

  Arcane::IntegerConstArrayView sizeOfLocalIndex() const;
  Arcane::IntegerConstArrayView offsetOfLocalIndex() const;
  
private:

  struct EntrySendRequest;
  struct EntryRecvRequest;
  
private:

  bool m_is_prepared;

  Integer m_local_size;
  Integer m_max_size;

  ValuePerBlock m_sizes;
  ValuePerBlock m_offsets;

  Arcane::IntegerSharedArray m_local_sizes;
  Arcane::IntegerSharedArray m_local_offsets;
};

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

END_ALIEN_NAMESPACE

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

#endif /* ARCGEOSIM_ARCGEOSIM_NUMERICS_LINEARALGEBRA2_BLOCKSIZES_H */
