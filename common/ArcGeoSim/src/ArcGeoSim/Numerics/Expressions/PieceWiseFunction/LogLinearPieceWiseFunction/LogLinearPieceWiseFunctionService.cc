#include "LogLinearPieceWiseFunctionService.h"
/* Author : dechaiss at Tue Oct 20 13:56:57 2009
 * Generated by createNew
 */

using namespace Arcane;

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

void
LogLinearPieceWiseFunctionService::init()
  {
    if (m_initialized)
      return;

    info() << A_FUNCINFO;

    setVariableName(options()->variable());

    const Integer size_x = options()->x.size();
    const Integer size_y = options()->y.size();

    if (size_y != size_x)
      {
        fatal() << A_FUNCINFO << " nb points x != nb points y";
      }

    //! Define boundary behavior of tabulated function
    initBorderCondition(options()->borderCondition().borderType(),
        options()->borderCondition.prolongationType(),
        options()->borderCondition.borderLimits().lowerLimit(),
        options()->borderCondition.borderLimits().upperLimit(),
        options()->borderCondition.cutType());

    //! Fill table
    switch (options()->ordinateMode())
      {
    case DataSetType::LogarithmOrdinate:
      {
        for (Integer iPoint = 0; iPoint < size_x; ++iPoint)
          {
            setPoint(options()->x[iPoint], options()->y[iPoint]);
          }
      }
      break;
    case DataSetType::NotLogarithmOrdinate:
      {
        for (Integer iPoint = 0; iPoint < size_x; ++iPoint)
          {
            Real y = options()->y[iPoint];
            if (y <= 0)
              fatal() << "Cannot take log10(y) with y<=0";
            setPoint(options()->x[iPoint], math::log10(y));
          }
      }
      break;
      }

    //! Init PieceWiseFunctionR1vR1T<LogLinearInterpolator> (must be done after filling table)
    PieceWiseFunctionR1vR1T<LogLinearInterpolator>::init();

    // Debug Print
    //    printPoints();

    m_initialized = true;
  }

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/

ARCANE_REGISTER_SERVICE_LOGLINEARPIECEWISEFUNCTION(LogLinearPieceWiseFunction,LogLinearPieceWiseFunctionService);
