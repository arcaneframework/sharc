#include "KozenyCarmannFunction.h"
/* Author : desrozis at Tue Feb 17 08:52:36 2009
 * Generated by createNew
 */

#include <arcane/utils/TraceInfo.h>

/*---------------------------------------------------------------------------*/

void 
KozenyCarmannFunction::
init()
{
  ;
}

/*---------------------------------------------------------------------------*/

void  
KozenyCarmannFunction::
setParameter(const String & name, const Real & parameter)
{
  if(name != m_parameter_name)
  {
    m_trace_mng->fatal() << "Cannot set parameter data for undefined parameter '" << name << "'";
  }

  m_parameter_value = parameter;
  
  computeFactor();
}

/*---------------------------------------------------------------------------*/

  void  
KozenyCarmannFunction::
setParameter(Integer index, const Real & parameter)
{
  if(index != 0)
  {
    m_trace_mng->fatal() << "Cannot set parameter data for undefined parameter index '" << index << "'";
  }

  m_parameter_value = parameter;

  computeFactor();
}

/*---------------------------------------------------------------------------*/

void  
KozenyCarmannFunction::
computeFactor()
{
  const Real parameter_2 =  m_parameter_value * m_parameter_value;
  
  m_0_2_div_parameter_2_factor = 0.2 / parameter_2;
  
  m_20_div_parameter_2_factor = 100.*m_0_2_div_parameter_2_factor;
}

/*---------------------------------------------------------------------------*/

Integer  
KozenyCarmannFunction::
nbParameter() const
{
  return 1;
}

/*---------------------------------------------------------------------------*/

String  
KozenyCarmannFunction::
parameterName(Integer index) const
{
  return m_parameter_name;
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setVariable(const String & name, const Array<Real> & variable)
{
	if(name != m_variable_name)
	{
		m_trace_mng->fatal() << "Cannot set variable data for undefined variable '" << name << "'";
	}

	m_variable.setArray(variable);
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setVariable(Integer index, const Array<Real> & variable)
{
	if (index != 0)
	{
		m_trace_mng->fatal() << "Cannot set variable data for undefined variable position " << index;
	}

	m_variable.setArray(variable);
}
  
/*---------------------------------------------------------------------------*/

  Integer  
KozenyCarmannFunction::
nbVariable() const
{
  return 1;
}

/*---------------------------------------------------------------------------*/

String 
KozenyCarmannFunction::
variableName(Integer index) const
{
  if(index != 0)
  {
    m_trace_mng->fatal() << "Variable index " << index << " not defined for PieceWiseFunction";
  }
  return m_variable_name;
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setEvaluationResult(Array<Real> & result)
{
	m_eval_result.setArray(result);
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setDerivationResult(Integer di, Array<Real> & result)
{
	if (di != 0)
	{
		m_trace_mng->fatal() << "Cannot derive following undefined variable index " << di;
	}
	m_diff_result.setArray(result);
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setDerivationResult(const String & di, Array<Real> & result)
{
	if (di != m_variable_name)
	{
		m_trace_mng->fatal() << "Cannot derive following undefined variable '" << m_variable_name << "'";
	}
	m_diff_result.setArray(result);
}

/*---------------------------------------------------------------------------*/

void  
KozenyCarmannFunction::
eval()
{
  const Integer size = m_variable.size();

  if(m_eval_result.size() != size)
  {
    m_trace_mng->fatal() << "variable size differs to result size";
  }

  for(Integer i=0; i<size; ++i)
  {
    eval(m_variable[i],m_eval_result[i]);
  }
}

/*---------------------------------------------------------------------------*/

void  
KozenyCarmannFunction::
cleanup()
{
  m_variable = RealConstArrayView();
  m_eval_result = RealArrayView();
  m_diff_result = RealArrayView();
}

/*---------------------------------------------------------------------------*/

Real  
KozenyCarmannFunction::
eval(const Real & var0)
{
  const Real so_carre = m_parameter_value * m_parameter_value;
 
  Real res0 =  0.2* var0 * var0 * var0/so_carre/(1-var0)/(1-var0);
  
  if (var0 <= 0.1) {
    res0 *= 100. * var0 * var0;
  }
  return res0;
}

/*---------------------------------------------------------------------------*/

void  
KozenyCarmannFunction::
eval(const Real & var0,
     Real & res0)
{
  const Real so_carre = m_parameter_value * m_parameter_value;
  res0 =0.2 * var0 * var0 * var0/so_carre/(1-var0)/(1-var0);
  
  if (var0 <= 0.1) 
    res0 *= 100. * var0 * var0;
  
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
eval(const Array<Real> & var0,
		Array<Real> & res0)
{
	const Integer size = var0.size();

	if(res0.size() != size)
	{
		m_trace_mng->fatal() << "variable size differs to result size";
	}

	for(Integer i=0; i<size; ++i)
	{
		eval(var0[i],res0[i]);
	}
}

/*---------------------------------------------------------------------------*/

void  
KozenyCarmannFunction::
eval(const ConstArrayView<Real> var0,
     ArrayView<Real> res0)
{
  const Integer size = var0.size();

  if(res0.size() != size)
  {
    m_trace_mng->fatal() << "variable size differs to result size";
  }

  for(Integer i=0; i<size; ++i)
  {
    eval(var0[i],res0[i]);
  }
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setVariableName(const String & name)
{
  m_variable_name = name;
}

/*---------------------------------------------------------------------------*/

void
KozenyCarmannFunction::
setParameterName(const String & name)
{
  m_parameter_name = name;
}

/*---------------------------------------------------------------------------*/

Real
KozenyCarmannFunction::
evalSup(const Real & var0) const
{
  const Real tmp = 1 - var0;
  
  if(tmp < 1.e-15)
  {
    m_trace_mng->fatal() << A_FUNCINFO << " division by zero"; 
  }

  return  m_0_2_div_parameter_2_factor * var0 * var0 * var0 / ( tmp * tmp );
}

/*---------------------------------------------------------------------------*/

Real
KozenyCarmannFunction::
evalInf(const Real & var0) const
{
  const Real tmp = 1 - var0;
  const Real var_2 = var0 * var0;
  const Real var_4 = var_2 * var_2;
 
  if(tmp < 1.e-15)
  {
    m_trace_mng->fatal() << A_FUNCINFO << " division by zero"; 
  }

  return  m_20_div_parameter_2_factor * var0 * var_4 / ( tmp * tmp );
}

/*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*/
