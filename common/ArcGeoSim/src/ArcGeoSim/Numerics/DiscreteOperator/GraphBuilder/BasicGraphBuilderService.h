#ifndef ARCGEOSIM_DISCRETEOPERATOR_GRAPHBUILDER_BASICGRAPHBUILDERSERVICE_H
#define ARCGEOSIM_DISCRETEOPERATOR_GRAPHBUILDER_BASICGRAPHBUILDERSERVICE_H
/* Author : dipietrd at Mon Dec 10 15:04:54 2007
 * Generated by createNew
 */

#include <map>
#include <list>

#include <arcane/IGraph.h>
#include <arcane/ItemGroupRangeIterator.h>

#include "ArcGeoSim/Numerics/DiscreteOperator/IGraphBuilder.h"
#include "BasicGraphBuilder_axl.h"

#include "ArcGeoSim/Utils/ItemComparator.h"
#include "ArcGeoSim/Utils/ItemGroupBuilder.h"

using namespace Arcane;

class BasicGraphBuilderService :
public ArcaneBasicGraphBuilderObject
{
 public:
  struct LinkDescriptor {
    LinkDescriptor(const Integer& _uid_I1, 
                   const Integer& _uid_I2) : uid_I1(_uid_I1),
         uid_I2(_uid_I2) {}
         
    Integer uid_I1;
    Integer uid_I2;
  };

  typedef std::map<Item, Integer, ItemComparator> Item2IntMap;
  typedef std::list<LinkDescriptor> LinkDescriptorList;
 public:
  //! Constructor
  BasicGraphBuilderService(const Arcane::ServiceBuildInfo & sbi) : 
    ArcaneBasicGraphBuilderObject(sbi),
    m_current_node_local_uid(0),
    m_node_global_uid_base(0) {
    m_graph = subDomain()->defaultGraph();
  }
  
  //! Destructor
  virtual ~BasicGraphBuilderService() {};  
 public:
  //! Add one node
  NodeDescriptor addNode(const Item& I);
  //! Finalize node addition
  void endAddNodes();
  //! Add one link
  void addLink(const Item& I1, const Item& I2);
  //! Finalize link addition
  void endAddLinks();

 private:
  //! Pointer to the graph
  IGraph* m_graph;
  //! Current node local unique id
  Integer m_current_node_local_uid;
  //! Current link local unique id
  Integer m_current_link_local_uid;
  //! Current domain's node global unique id base
  Integer m_node_global_uid_base;
  //! Dual cell to local unique id map
  Item2IntMap m_dual_cell_uid;
  //! Dual face to local unique id map
  Item2IntMap m_dual_face_uid;
  //! Links
  LinkDescriptorList m_links;
};

#endif /* ARCGEOSIM_DISCRETEOPERATOR_GRAPHBUILDER_BASICGRAPHBUILDERSERVICE_H */
