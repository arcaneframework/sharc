#include "ObservablePropertyTesterService.h"
/* Author : dipietrd at Wed Aug  6 11:29:08 2008
 * Generated by createNew
 */
#include <boost/bind.hpp>

using namespace Arcane;

/*---------------------------------------------------------------------------*/

void action1() {
  std::cout << "action 1" << std::endl;
}

/*---------------------------------------------------------------------------*/

void ObservablePropertyTesterService::action2() {
  std::cout << "action 2" << std::endl;
}

/*---------------------------------------------------------------------------*/

void ObservablePropertyTesterService::init() {
}

/*---------------------------------------------------------------------------*/

int ObservablePropertyTesterService::test() {
  // Create an observable property
  ObservableProperty p("property_name");
  
  info() << "Connect action1 and ObservablePropertyTesterService::action2";
  // Connect a function
  ObservableProperty::ConnectionType c1 =
    p.connectObserver(ObservableProperty::ObserverType(&action1));
  // Connect a member function
  ObservableProperty::ConnectionType c2 =
    p.connectObserver(ObservableProperty::ObserverType(boost::bind<void>(&ObservablePropertyTesterService::action2, this)));

  // Notify property change
  p.notifyChange();

  info() << "Block action1";
  // Block a function: action1 will not be called on change notification
  p.blockConnection(c1);
  p.notifyChange();

  info() << "Unblock action1";
  // Unblock a function: action1 will be called on change modification
  p.unblockConnection(c1);
  p.notifyChange();

  info() << "Remove action1";
  // Remove connection with action1
  p.removeConnection(c1);
  p.notifyChange();

  return 1;
}

/*---------------------------------------------------------------------------*/

ARCANE_REGISTER_SERVICE_OBSERVABLEPROPERTYTESTER(ObservablePropertyTester,ObservablePropertyTesterService);
