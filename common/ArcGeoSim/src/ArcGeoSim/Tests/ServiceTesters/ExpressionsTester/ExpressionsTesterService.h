#ifndef ARCGEOSIM_TESTS_SERVICETESTERS_EXPRESSIONSTESTER_EXPRESSIONSTESTERSERVICE_H
#define ARCGEOSIM_TESTS_SERVICETESTERS_EXPRESSIONSTESTER_EXPRESSIONSTESTERSERVICE_H
/* Author : desrozis at Wed Mar 25 15:33:55 2009
 * Generated by createNew
 */

#include <arcane/Timer.h>

#include "ArcGeoSim/Numerics/Expressions/IFunction.h"
#include "ArcGeoSim/Numerics/Expressions/IFunctionR1vR1.h"
#include "ArcGeoSim/Numerics/Expressions/IFunctionR2vR1.h"
#include "ArcGeoSim/Numerics/Expressions/IFunctionR3vR1.h"
#include "ArcGeoSim/Numerics/Expressions/IFunctionR4vR1.h"
#include "ArcGeoSim/Numerics/Expressions/IExpressionMng.h"


#include "ArcGeoSim/Tests/ServiceTesters/IServiceTester.h"

using namespace Arcane;

#include "ExpressionsTester_axl.h"

struct EvalTableTypes
  {
  enum eChoice
    {
    Random, FirstElements, LastElements, AllElements
    };
  };

class ExpressionsTesterService :
public ArcaneExpressionsTesterObject
{
 public:
  /** Constructeur de la classe */
  ExpressionsTesterService(const Arcane::ServiceBuildInfo & sbi)
    : ArcaneExpressionsTesterObject(sbi)
    , m_timer(sbi.subDomain(), "Timer", Timer::TimerVirtual)
    , m_x()
    , m_table_impl_cpu_comparison(false)
    , m_performance_test(false)
    {
      ;
    }

  /** Destructeur de la classe */
  virtual ~ExpressionsTesterService() {}

 public:

  //! Initialisation
  void init();

  //! Apply service function
  int test();

 private:

  Timer m_timer;
  SharedArray<Real> m_x;
  bool m_table_impl_cpu_comparison; // plug piecewisefunction vs physical law cpu comparison
  bool m_performance_test; // plug expression performance test
  Integer m_nb_points, m_total_loop;
  Real m_xmax_table, m_xmin_table;

  // Test fonctionnel
  void _functionalTest();
  // Test de performance
  void _performanceTest();

  //! Evaluation des Tables
  //! Evaluation de la fonction
  template<typename T> void evalTable(T t, const EvalTableTypes::eChoice & choice_eval);
  //! Evaluation de la d���riv���e
  void diffEvalTable(IFunctionR1vR1* i_func);
  void diffEvalLimitPoints(IFunctionR1vR1* i_func);
  bool _checkValues(const ConstArrayView<Real>& a , const ConstArrayView<Real>& b);
  //! Evaluation des outils bases sur Arcane::Array2 utilises dans PieceWiseFunctionR2vR1
  void _checkArray2Tools();

};

#endif /* ARCGEOSIM_TESTS_SERVICETESTERS_EXPRESSIONSTESTER_EXPRESSIONSTESTERSERVICE_H */
